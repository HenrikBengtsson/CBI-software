help([[
IGV: The Integrative Genomics Viewer
]])

-- local name = myModuleName()
local name = "IGV"
local version = myModuleVersion()
whatis("Version: " .. version)
whatis("Keywords: sequencing")
whatis("URL: https://software.broadinstitute.org/software/igv/, https://github.com/igvteam/igv/tags (changelog), https://github.com/igvteam/igv/ (source code)")
whatis([[
Description: The Integrative Genomics Viewer (IGV) is a high-performance visualization tool for interactive exploration of large, integrated genomic datasets. It supports a wide variety of data types, including array-based and next-generation sequence data, and genomic annotations.
Examples: `igv --help`, `igv --version`, and `igv`.
Warning: IGV (>= 2.5.0) requires Java 11. Only the most recent version of this software will be kept.
]])

--depends_on("openjdk/11")

local root = os.getenv("SOFTWARE_ROOT_CBI")
local home = pathJoin(root, name .. "-" .. version)
prepend_path("PATH", home)

local java_check = 'ver=$(java -version 2>&1 | grep -F "version" | sed -E "s/(.* version |\\")//g"); >&2 echo "Java version: ${ver} [IGV requires Java 11 or newer]"; ver_x=$(sed -E "s/^1[.]//" <<< "${ver}" | sed "s/[.].*//"); if [[ ${ver_x} -lt 11 ]]; then >&2 echo "ERROR: Java ${ver_x} detected, but IGV requires Java 11 or newer: $(java -version 2>&1 | grep -F "version")"; return 1; fi;'

local bash = java_check .. ' ' .. home .. '/igv.sh "$@"'
local csh  = home .. '/igv.sh $*'
set_shell_function("igv", bash, csh)

-- Tweak Java for the current environment
depends_on("java-tweaks")
